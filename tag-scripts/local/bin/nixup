#!/bin/bash

cwd_name=${PWD##*/}

cabal2nix . > default.nix
cabal2nix . --shell > shell.nix
touch ./release.nix

echo "let
  config = {
    packageOverrides = pkgs: rec {
      haskellPackages = pkgs.haskellPackages.override {
        overrides = haskellPackagesNew: haskellPackagesOld: rec {
          $cwd_name =
            haskellPackagesNew.callPackage ./default.nix { };
        };
      };
    };
  };

pkgs = import <nixpkgs> { inherit config; };

in
  { $cwd_name = pkgs.haskellPackages.$cwd_name;
  }
" > ./release.nix
